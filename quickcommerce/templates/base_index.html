<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Experience the fastest fashion delivery with Rapparel. Get trendy outfits delivered to your doorstep in just 90 minutes. Perfect for last-minute plans. shop smarter, faster, and better!">
  <title>{% block title %}Rapparel{% endblock %}</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  {% load static %}
  <link rel="icon" href="{% static 'img/site-favicon.ico' %}" type="image/x-icon">
  <link rel="stylesheet" href="{% static 'css/home.css' %}">
  

 <style>
 

@media (max-width:768px) {

  

  #checktabmsg{
            margin-top: 14rem !important;
        }
        .container-fluid{
            margin-top: 11rem !important;
        }

        header {
          padding: 0 !important;
        }
    
}
.navbar .d-flex{
        margin-top: 0rem !important;
  }
@media (max-width: 320px) {
  p, li {
    font-size: 0.75rem;
  }
}
  

      



 </style>
  <!-- Additional CSS goes here -->
  {% block extra_css %}
  {% endblock %}
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GTKWH8W36P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GTKWH8W36P');
</script>
<body>


    
  <header id="mobile-header" class="d-none mobile-nav">
    <nav class="navbar navbar-light bg-white justify-content-between  px-3 py-2">
      <div class="d-flex align-items-center">
        <a class="navbar-brand" href="/">
          <img src="{%  static 'img/logo.svg'  %}" alt="Rapparel Logo" width="70" height="70">
        </a>
        <div class="location-input-container">
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text text-sm" id="location-icon-mobile">
                <i class="bi bi-geo-alt-fill"></i>
              </span>
            </div>
            <input type="text" id="location-input-mobile" placeholder="Location detected" class="form-control" disabled>
            <select id="location-select-mobile" class="form-control d-none">
            </select>
            <div class="input-group-append">
              <span class="input-group-text text-sm" id="search-icon-mobile">
                <i class="fas fa-search"></i>
              </span>
              {% if user.is_authenticated %}
              <span class="input-group-text text-sm d-none" id="select-icon-mobile">
                <i class="fas fa-list"></i>
              </span>
            {% endif %}
            </div>
            
          </div>        
         
          
          <div id="location-suggestions-mobile"  style="position: absolute; z-index: 1000;" class="list-group d-none"></div>
  
      </div>
      </div>

      <div class="d-flex align-items-center mt-0" style="width: 100%;">
      <div class="input-group">
        <form id="search-form" class="form-inline position-relative" style="flex-grow: 1;">
          <input id="search-bar-mobile" class="form-control" type="text" placeholder="Search products" aria-label="Search">
         
        </form>
      <div id="search-results-mobile" class="list-group d-none" style="margin-top: 2.4rem; position: absolute; z-index: 1000; width: 100%;">
      </div>
    </div>
        </div>


    </nav>
  </header>

  <nav class="navbar desktop-nav navbar-light bg-white content-container d-flex justify-content-between align-items-center" style="flex-wrap: nowrap">
    <!-- Left-aligned div -->
    <div class="d-flex align-items-center flex-shrink-1">
      <a class="navbar-brand" href="/">
        <img src="{% static 'img/logo.svg' %}" alt="Rapparel Logo" width="70" height="70">
      </a>
      <div class="location-input-container" style="max-width: 80%;">
        <div class="input-group">
          <div class="input-group-prepend">
            <span class="input-group-text text-sm" id="location-icon-desktop">
              <i class="bi bi-geo-alt-fill"></i>
            </span>
          </div>
          <input type="text" id="location-input-desktop" placeholder="Location detected" class="form-control" disabled>
          <select id="location-select-desktop" class="form-control d-none" style="max-width: 50%;"></select>
          <div class="input-group-append">
            <span class="input-group-text text-sm" id="search-icon-desktop">
              <i class="fas fa-search"></i>
            </span>
            {% if user.is_authenticated %}
            <span class="input-group-text text-sm d-none" id="select-icon-desktop">
              <i class="fas fa-list"></i>
            </span>
            {% endif %}
          </div>
        </div>
        <div id="location-suggestions-desktop" style="position: absolute; z-index: 1000;" class="list-group d-none"></div>
      </div>
    </div>
  
    <!-- Right-aligned div -->
    <div class="d-flex align-items-center flex-shrink-0">
      <div class="input-group">
        <form id="search-form" class="form-inline position-relative mr-2" style="flex-grow: 1;">
          <input id="search-bar" class="form-control" type="text" placeholder="Search products" aria-label="Search">
        </form>
        <div id="search-results" class="list-group d-none" style="margin-top: 2.4rem; position: absolute; z-index: 1000;">
          <!-- Search results will be dynamically inserted here -->
        </div>
      </div>
      <a href="{% url 'customer_wishlist' %}" class="mr-3"><i class="bi bi-heart"></i></a>
      <a href="{% url 'cart_checkout' %}" class="mr-3"><i class="bi bi-bag"></i></a>
      <a href="{% url 'customer_past_orders' %}"><i class="bi bi-person-circle"></i></a>
    </div>
  </nav>
  
  

  <!-- Main content block -->
  <div class="container-fluid">
    {% block content %}
    <!-- This block will be replaced with page-specific content -->
    {% endblock %}
  </div>

  <!-- Footer -->
  <footer class="bg-light text-justify text-lg-start">
    <div class="container p-4">
      <div class="row">
        <div class="col-lg-3 col-md-6 mb-4">
          <img src="{%  static 'img/logo.svg'  %}" alt="Rapparel Logo" width="100" height="100">
          <p class="mt-3">
            Where fashion meets speed! Our mission is to redefine the way you shop for the latest fashion trend.
          </p>
        </div>
        <!-- <div class="col-lg-2 col-md-6 mb-4">
          <h5>Shop</h5>
          <ul class="list-unstyled mb-0">
            <li><a href="#">Men</a></li>
            <li><a href="#">Women</a></li>
            <li><a href="#">Kids</a></li>
            <li><a href="#">Accessories</a></li>
            <li><a href="#">New Arrivals</a></li>
          </ul>
        </div> -->
        <div class="col-lg-2 col-md-6 mb-4">
          <ul class="list-unstyled mb-0">
            <li><a href="/about-us/">About Us</a></li>
            <li><a href="/contact-us/">Contact Us</a></li>
            <!-- <li><a href="#">Careers</a></li> -->
            <!-- <li><a href="#">Blog</a></li> -->
            <!-- <li><a href="#">Store Locator</a></li> -->
          </ul>
        </div>
        <div class="col-lg-2 col-md-6 mb-4">
          
          <ul class="list-unstyled mb-0">
            <li><a href="/faq/">FAQs</a></li>
            <li><a href="/shipping-policy/">Shipping</a></li>
            <li><a href="/return-refund-policy/">Returns & Refunds</a></li>
            <li><a href="/terms-conditions/">Terms & Conditions</a></li>
            <li><a href="/privacy/">Privacy</a></li>
          </ul>
        </div>
      </div>
      <div class="divider"></div>
      <div class="text-center pt-3">
        <!-- <a href="#" class="mr-3"><i class="bi bi-facebook"></i></a>
        <a href="#" class="mr-3"><i class="bi bi-twitter"></i></a> -->
        <a href="https://www.instagram.com/rapparelsolutions" target="_blank" class="mr-3"><i class="bi bi-instagram"></i></a>
        <!-- <a href="#"><i class="bi bi-linkedin"></i></a> -->
      </div>
      <div class="text-center mt-4">
        <span class="text-muted">&copy; 2024 Rapparel. All Rights Reserved.</span>
      </div>
    </div>
  </footer>

  <!-- Bottom Navigation Bar for Mobile -->
<nav id="bottom-nav" class="navbar fixed-bottom navbar-light bg-light">
    <div class="d-flex justify-content-around w-100">
      <a href="/" class="nav-item text-center">
        <i class="bi bi-house-door" style="font-size: 1.5rem;"></i>
        <p>Home</p>
      </a>
      <a href="/checkout/" class="nav-item text-center">
        <i class="bi bi-bag" style="font-size: 1.5rem;"></i>
        <p>Bag</p>
      </a>
      <a href="/customer/profile/" class="nav-item text-center">
        <i class="bi bi-person-circle" style="font-size: 1.5rem;"></i>
        <p>Account</p>
      </a>
      <a href="/customer/wishlist/"  class="nav-item text-center">
        <i class="bi bi-heart" style="font-size: 1.5rem;"></i>
        <p>Wishlist</p>
      </a>
    </div>
  </nav>

  <script src="https://kit.fontawesome.com/a076d05399.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="{% static 'js/home.js' %}"></script>

  <script>
 $(document).ready(function () {


    var typingTimer;
    var doneTypingInterval = 300; // Time in ms (0.3 seconds)
    var $input = $('#location-input-desktop, #location-input-mobile');
    var $suggestions = $('#location-suggestions-desktop, #location-suggestions-mobile');
    var $dropdown = $('#location-select-desktop, #location-select-mobile');
    var currentAddress = '';

    

    // Initially fetch real-time location when page loads
    detectRealTimeLocation();

    // On keyup, start the countdown for the user typing
    $input.on('keyup', function () {
        clearTimeout(typingTimer);
        typingTimer = setTimeout(doneTyping, doneTypingInterval);
    });

    // On keydown, clear the countdown
    $input.on('keydown', function () {
        clearTimeout(typingTimer);
    });

    // User is done typing, fetch suggestions
    function doneTyping() {
        var query = $input.val();

        // If the input is empty, clear the suggestions
        if (query.length === 0) {
            $suggestions.empty().addClass('d-none');
            return;
        }

        // Make an AJAX request to the Nominatim API for autocomplete suggestions
        var apiUrl = '/autocomplete/?query=' + query;

        $.getJSON(apiUrl, function (data) {
            // Clear previous suggestions
            $suggestions.empty();

            // If no results, show "No results found"
            if (data.locations.length === 0) {
              $suggestions.append('<div class="list-group-item list-group-item-action">No results found</div>');
          } else {
                // Loop through results and append to suggestions div
                data.locations.forEach(function (item) {
                  var displayAddress = item.description; // Get the address from 'description'
                  var lat = item.geometry.lat; // Get the latitude from 'geometry'
                  var lon = item.geometry.lng; // Get the longitude from 'geometry'

                  // Append each result as an option
                  $suggestions.append(
                      '<a href="#" class="list-group-item list-group-item-action" data-lat="' + lat + '" data-lon="' + lon + '">' + displayAddress + '</a>'
                  );
              });
            }

            // Show the suggestions box
            $suggestions.removeClass('d-none');
        });
    }

    // Handle clicking on a suggestion
    $suggestions.on('click', 'a', function (e) {
        e.preventDefault();

        // Get the selected address and coordinates
        var selectedAddress = $(this).text();
        var latitude = $(this).data('lat');
        var longitude = $(this).data('lon');

        // Update the input field with the selected address
        $input.val(selectedAddress);
        $suggestions.empty().addClass('d-none'); // Hide suggestions

        // Optionally, send the latitude and longitude to the server or update the URL
        updateUrlWithLocation(latitude, longitude);
    });

    // Function to update URL with latitude and longitude
    function updateUrlWithLocation(latitude, longitude) {
        var currentUrl = window.location.href.split('?')[0]; // Get current URL without query params
        var newUrl = currentUrl + '?latitude=' + latitude + '&longitude=' + longitude;
        history.replaceState({}, '', newUrl); // Update the URL without reloading the page
    }

    var savedAddresses = []; // This will be fetched using AJAX

    // Fetch saved addresses using AJAX when the page loads
    $.ajax({
        url: "{% url 'fetch_saved_addresses' %}",  // URL of the view you created
        method: "GET",
        success: function(data) {
            savedAddresses = data;
            updateDropdownWithSavedAddresses(); // Update dropdown with saved addresses
        },
        error: function(error) {
            console.log("Error fetching saved addresses:", error);
        }
    });

    // Detect real-time location on page load
    function detectRealTimeLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function (position) {
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;

                // Use reverse geocoding to convert coordinates into an address
                var geocodingUrl = '/reverse-geocode/?lat=' + latitude + '&lng=' + longitude;

                $.getJSON(geocodingUrl, function (data) {
                    var currentAddress = data.display_name;

                    // Display detected address in the input field
                    $input.val(currentAddress);
                    $input.prop('disabled', true); // Disable the input field for detected address
                    $input.attr('placeholder', 'Location detected');
                    updateUrlWithLocation(latitude, longitude);

                    // If the dropdown is visible, update it with current location
                    if (!$dropdown.hasClass('d-none')) {
                      updateCurrentLocationOption(currentAddress);
                    }
                });
            },
            function (error) {
                // Change the placeholder if location access is denied
                $input.val('').attr('placeholder', 'User Denied Location Access');

                // Remove the click event if it already exists to prevent multiple bindings
                $input.off('click', detectRealTimeLocation);
                
                // Allow retrying location detection when clicking the input
                $input.on('click', function() {
                    $input.val(''); // Clear input on click to prompt for location again
                    $input.attr('placeholder', 'Checking location...'); // Temporary placeholder
                    detectRealTimeLocation(); // Retry detecting location
                });
            }
        );
    } else {
        alert('Geolocation is not supported by this browser.');
    }
}

// Function to update the current location option in the dropdown
function updateCurrentLocationOption(currentAddress) {
    // Check if the current location option already exists
    var $currentLocationOption = $dropdown.find('option[value="current_location"]');

    // Update or create the current location option
    if ($currentLocationOption.length) {
        // Update the text of the existing option
        $currentLocationOption.text(`Current Location: ${currentAddress}`);
    } else {
        // Append a new option for the current location
        $dropdown.append(new Option(`Current Location: ${currentAddress}`, "current_location"));
    }
}



    // Update dropdown with saved addresses and search option
    function updateDropdownWithSavedAddresses() {
        if (savedAddresses.length > 0) {
            // Convert the input to a dropdown if saved addresses are available
            $input.addClass('d-none'); // Hide input field
            $dropdown.removeClass('d-none'); // Show dropdown

            // Populate the dropdown with saved addresses
            savedAddresses.forEach(function (address) {
                var displayAddress = address.street_address + ', ' + address.city + ', ' + address.state + ', ' + address.country;
                // Prevent adding the same address multiple times
                if (!$dropdown.find(`option[value="${address.id}"]`).length) {
                    $dropdown.append(new Option(displayAddress, address.id));
                }
                updateUrlWithLocation(null, null); // No coordinates to send
                // $('#select-icon-desktop').removeClass('d-none');
            });

            // Add the current location option if not already present
            if (!$dropdown.find('option[value="current_location"]').length) {
              
                $dropdown.append(new Option(`Current Location: ${currentAddress}`, "current_location"));
            }
            

            // Add the search option at the end
            // if (!$dropdown.find('option[value="search"]').length) {
            //     $dropdown.append(new Option("Search for address", "search"));
            // }
        } else {
            // If no saved addresses, use real-time location detection
            detectRealTimeLocation();
        }
    }

    // Handle dropdown change to allow switching between manual entry and saved addresses
    $dropdown.on('change', function() {
        var selectedValue = $(this).val();
        if (selectedValue === "current_location") {
            detectRealTimeLocation(); // Re-trigger location detection
        } 
        // else if (selectedValue === "search") {
        //     // Show input box for searching
        //     $input.val('').prop('disabled', false).attr('placeholder', 'Search for address').focus();
        //     $input.removeClass('d-none');
        //     $dropdown.addClass('d-none'); // Hide dropdown
        //     $suggestions.empty().addClass('d-none'); // Hide suggestions
        // } 
        else {
            // Handle selection of saved address
            var selectedAddress = $(this).find('option:selected').text();
            $input.val(selectedAddress); // Update the input field with the selected address
            // Optionally, send the selected address to the server or update the URL
            updateUrlWithLocation(null, null); // No coordinates to send
        }
    });

    // Handle search icon click
    $('#search-icon-desktop').on('click', function() {
        if ($input.prop('disabled')) {
            $input.val('').prop('disabled', false).attr('placeholder', 'Search for address').focus();
            $input.removeClass('d-none');
            $dropdown.addClass('d-none'); // Hide dropdown
            $('#search-icon-desktop').addClass('d-none');
            $('#select-icon-desktop').removeClass('d-none');
            $suggestions.empty().addClass('d-none');
        }
    });


 // Handle search icon click
 $('#search-icon-mobile').on('click', function() {
        if ($input.prop('disabled')) {
            $input.val('').prop('disabled', false).attr('placeholder', 'Search for address').focus();
            $input.removeClass('d-none');
            $dropdown.addClass('d-none'); // Hide dropdown
            $('#search-icon-mobile').addClass('d-none');
            $('#select-icon-mobile').removeClass('d-none');
            $suggestions.empty().addClass('d-none');
        }
    });

     // Handle select icon click
     $('#select-icon-desktop').on('click', function() {
        if (!$input.prop('disabled')) {
            $input.val('').prop('disabled', true).attr('placeholder', 'Search for address').focus();
            $input.addClass('d-none');
            
        }
        $dropdown.removeClass('d-none'); // Hide dropdown
            $('#search-icon-desktop').removeClass('d-none');
            $('#select-icon-desktop').addClass('d-none');
            $suggestions.empty().addClass('d-none');
    });

    // Handle select icon click
    $('#select-icon-mobile').on('click', function() {
        if (!$input.prop('disabled')) {
            $input.val('').prop('disabled', true).attr('placeholder', 'Search for address').focus();
            $input.addClass('d-none');
            
        }
        $dropdown.removeClass('d-none'); // Hide dropdown
            $('#search-icon-mobile').removeClass('d-none');
            $('#select-icon-mobile').addClass('d-none');
            $suggestions.empty().addClass('d-none');
    });


    // Function to update URL with latitude and longitude
    function updateUrlWithLocation(latitude, longitude) {
    var currentUrl = window.location.href.split('?')[0]; // Get current URL without query params
    
    // Check if both latitude and longitude are null
    if (latitude === null && longitude === null) {
        // Clean URL without any query params
        history.replaceState({}, '', currentUrl);
    } else {
        // Construct the URL with latitude and longitude query params
        var newUrl = currentUrl + '?latitude=' + latitude + '&longitude=' + longitude;
        history.replaceState({}, '', newUrl); // Update the URL without reloading the page
    }
}

     // Function to update the href for each brand link with latitude and longitude
     function updateBrandLinksWithLocation(latitude, longitude) {
        $('.brand-item a').each(function() {
            var brandSlug = $(this).data('brand-slug');
            var newHref = "{% url 'brand_stores' 'brand-slug' %}".replace('brand-slug', brandSlug);

            // Append latitude and longitude as query parameters
            newHref += "?latitude=" + latitude + "&longitude=" + longitude;
            $(this).attr('href', newHref);
        });
    }


    // Function to update the href for each brand link with the saved address id
    function updateBrandLinksWithAddress(addressId) {
        $('.brand-item a').each(function() {
            var brandSlug = $(this).data('brand-slug');
            var newHref = "{% url 'brand_stores' 'brand-slug' %}".replace('brand-slug', brandSlug);

            // Append the address id as a query parameter
            newHref += "?address_id=" + addressId;
            $(this).attr('href', newHref);
        });
    }

    // Function to update the href for each category link with latitude and longitude
    function updateCategoryLinksWithLocation(latitude, longitude) {
        $('.category-item a').each(function() {
            var categorySlug = $(this).data('category-slug');
            var newHref = "{% url 'category_stores' 'category-slug' %}".replace('category-slug', categorySlug);

            // Append latitude and longitude as query parameters
            newHref += "?latitude=" + latitude + "&longitude=" + longitude;
            $(this).attr('href', newHref);
        });
    }

    // Function to update the href for each category link with the saved address id
    function updateCategoryLinksWithAddress(addressId) {
        $('.category-item a').each(function() {
            var categorySlug = $(this).data('category-slug');
            var newHref = "{% url 'category_stores' 'category-slug' %}".replace('category-slug', categorySlug);

            // Append the address id as a query parameter
            newHref += "?address_id=" + addressId;
            $(this).attr('href', newHref);
        });
    }
});
</script>
<script>
  const totalCards = $('.store-card').length;

// Hide the "View More" button if there are 8 or fewer cards
if (totalCards <= 8) {
    $('#viewMoreBtn').hide();
}

$('#viewMoreBtn').on('click', function () {
    // Select the hidden store cards
    const hiddenCards = $('.store-card.d-none');
    
    // Reveal the next 8 hidden cards
    hiddenCards.slice(0, 8).removeClass('d-none');
    
    // If no more hidden cards, hide the View More button
    if ($('.store-card.d-none').length === 0) {
        $(this).hide();
    }
});
</script>
<script>
  $(document).ready(function() {
    let typingTimer;
    const typingDelay = 300; // 3s delay after typing stops
    const searchInputs = $('#search-bar, #search-bar-mobile');  // Select both inputs
    const searchResults = $('#search-results, #search-results-mobile');

    // Function to perform the search request
    function performSearch(query) {
      // console.log('Performing search for:', query);  // Add log to check if search is triggered

        $.ajax({
            url: '/search/',  // The URL of your search view
            method: 'GET',
            data: {
                'query': query
            },
            success: function(response) {
              console.log('Response:', response); 
                if (response.products && response.products.length > 0) {
                    searchResults.empty(); 
                    response.products.forEach(product => {
                      const productHTML = `
                        <div class="list-group-item list-group-item-action d-flex mt-0 align-items-center">
                            <div class="mr-3">
                                <img src="${product.image}" alt="${product.name}" class="img-fluid rounded" style="width: 50px; height: 50px;">
                            </div>
                            <div class="flex-grow-1">
                                <a href="/product/${product.slug}/" class="text-dark fw-bold d-block">${product.name}</a>
                                <small class="text-muted">Brand: ${product.brand}</small><br>
                                <small class="text-muted">Rs. ${parseFloat(product.price).toFixed(2)}</small>
                            </div>
                        </div>`;
                        searchResults.append(productHTML);  // Append the result to the results div
                    });
                    searchResults.removeClass('d-none');  // Show results
                } else {
                    searchResults.html('<div class="list-group-item list-group-item-action">No results found</div>').removeClass('d-none');
                }
            },
            error: function(error) {
                console.log('Error:', error);
            }
        });
    }

    // // Handle input event on the search bar
    searchInputs.on('input', function() {
        const query = $(this).val();
        clearTimeout(typingTimer);
        if (query.length >= 2) {
            typingTimer = setTimeout(() => performSearch(query), typingDelay);
        } else {
          searchResults.empty().addClass('d-none'); // Hide the results if less than 2 characters
        }
    });
});

</script>
</body>

</html>
